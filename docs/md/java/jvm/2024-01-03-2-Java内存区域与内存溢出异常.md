---
title: 第二章、Java内存区域与内存溢出异常
---
# 第二章、Java内存区域与内存溢出异常

一般来说，和C、C++不同，Java是由虚拟机管理内存，不需要开发者去操心。但当出现问题时(比如常见的内存溢出、泄露)，如果对JVM不了解就很难去排查问题

## 2.1 运行时数据区域

跟据《Java虚拟机规范》的规定，Java虚拟机所管理的内存将会包括以下几个运行时数据区域。开始对这几个区域做详细的学习。

![jvm-memory](../../../images/java/jvm/jvm-memory.jpg)

### 2.1.1 程序计数器

程序计数器是程序控制流的指示器，分支、循环、跳转、异常处理、线程恢复等基础功能都依赖程序计数器来完成。每个线程的程序计数器都独立存储、互不影响，故称为线程私有区域。

如果线程正在执行一个Java方法，那么计数器中记录的是正在执行的虚拟机字节码指令的地址。如果正在执行本地方法，计数器的值应该为空。

::: danger 疑问1

正在执行的虚拟机字节码指令的地址这个地址具体是什么呢？

:::

::: tip 解答1

虚拟机字节码指令的地址通常是指字节码流中每条指令的位置。这个地址是相对于方法的起始位置的偏移量，以字节为单位。用于在运行时执行和跟踪代码。如这段代码：

```java
public class Example {
    public static void main(String[] args) {
        int a = 5;
        int b = 10;
        int result = addNumbers(a, b);
        System.out.println("Result: " + result);
    }

    public static int addNumbers(int x, int y) {
        return x + y;
    }
}
```

通过javap反编译字节码

```java
public class Example {
  public Example();
    Code:
       0: aload_0
       1: invokespecial #1    // Method java/lang/Object."<init>":()V
       4: return

  public static void main(java.lang.String[]);
    Code:
       0: iconst_5
       1: istore_1
       2: bipush        10
       4: istore_2
       5: iload_1
       6: iload_2
       7: invokestatic  #2   // Method addNumbers:(II)I
      10: istore_3
      11: getstatic     #3  // Field java/lang/System.out:Ljava/io/PrintStream;
      14: new           #4   // class java/lang/StringBuilder
      17: dup
      18: ldc           #5   // String Result:
      20: invokespecial #6    // Method java/lang/StringBuilder."<init>":(Ljava/lang/String;)V
      23: iload_3
      24: invokevirtual #7    // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
      27: invokevirtual #8    // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      30: invokevirtual #9    // Method java/io/PrintStream.println:(Ljava/lang/String;)V
      33: return

  public static int addNumbers(int, int);
    Code:
       0: iload_0
       1: iload_1
       2: iadd
       3: ireturn
}
```

iconst_5其地址是0，istore_1其地址是1，这就是程序计数器中保存的内容。<font color="green">而这个偏移量，就是栈顶栈帧中的方法正在执行的位置</font>

:::